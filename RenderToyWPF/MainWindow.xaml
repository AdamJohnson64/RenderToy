<Window x:Class="RenderToy.WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:rendertoy="clr-namespace:RenderToy.WPF"
        mc:Ignorable="d"
        Title="RenderToy Experiment" Height="600" Width="1024">
    <DockPanel>
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="File">
                <MenuItem Header="New" Command="{x:Static rendertoy:MainWindow.CommandSceneNew}"/>
                <MenuItem Header="Open" Command="{x:Static rendertoy:MainWindow.CommandSceneOpen}"/>
                <MenuItem Header="Plane" Command="{x:Static rendertoy:MainWindow.CommandScenePlane}"/>
                <MenuItem Header="Add Sphere" Command="{x:Static rendertoy:MainWindow.CommandSceneAddSphere}"/>
            </MenuItem>
            <MenuItem Header="Debug">
                <MenuItem Header="Performance Trace" Command="{x:Static rendertoy:MainWindow.CommandDebugToolPerformanceTrace}"/>
            </MenuItem>
            <MenuItem Header="Help">
                <MenuItem Header="Open RenderToy Document" Command="{x:Static rendertoy:MainWindow.CommandDocumentOpen}"/>
                <MenuItem Header="Export RenderToy Document" Command="{x:Static rendertoy:MainWindow.CommandDocumentExport}"/>
            </MenuItem>
        </Menu>
        <TabControl>
            <!-- ==================== RenderToy Inspiration & History ==================== -->
            <TabItem Header="Interactive View" DataContext="{Binding Path=Scene}">
                <DockPanel>
                    <!-- Scene Graph -->
                    <TreeView DockPanel.Dock="Left" ItemsSource="{Binding Path=Children}" Width="256">
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                <TextBlock Text="{Binding Name}"/>
                                <HierarchicalDataTemplate.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" />
                                    </DataTemplate>
                                </HierarchicalDataTemplate.ItemTemplate>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>
                    <!-- Menu -->
                    <Menu DockPanel.Dock="Top">
                        <MenuItem Header="View">
                            <MenuItem Header="Preview" Command="{x:Static rendertoy:MainWindow.CommandRenderPreviewsToggle}"/>
                            <MenuItem Header="Wireframe" Command="{x:Static rendertoy:MainWindow.CommandRenderWireframeToggle}"/>
                        </MenuItem>
                    </Menu>
                    <!-- View Area -->
                    <Grid Background="LightGray">
                        <!-- Main Viewport Layer -->
                        <rendertoy:ViewSoftwareCustomizable x:Name="ViewMain" rendertoy:AttachedView.Scene="{Binding}" rendertoy:AttachedView.TransformModelViewProjection="{Binding Source={StaticResource Camera}, Path=TransformModelViewProjection}" rendertoy:AttachedCamera.Camera="{StaticResource Camera}"/>
                        <!-- Wireframe Layer -->
                        <rendertoy:ViewSoftwareWireframe x:Name="ViewWireframe" IsHitTestVisible="False" rendertoy:AttachedView.Scene="{Binding}" rendertoy:AttachedView.TransformModelViewProjection="{Binding Source={StaticResource Camera}, Path=TransformModelViewProjection}" Opacity="0.5"/>
                        <!-- PIP Preview -->
                        <Border x:Name="ViewPreview" HorizontalAlignment="Right" VerticalAlignment="Top" BorderBrush="DarkGray" BorderThickness="2" CornerRadius="8" Margin="8" Padding="4">
                            <Border.Background>
                                <LinearGradientBrush>
                                    <LinearGradientBrush.Transform>
                                        <RotateTransform Angle="45"/>
                                    </LinearGradientBrush.Transform>
                                    <GradientStop Color="LightGray" Offset="0"/>
                                    <GradientStop Color="DarkGray" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <Border.Effect>
                                <DropShadowEffect Opacity="0.5" ShadowDepth="4"/>
                            </Border.Effect>
                            <StackPanel>
                                <TextBlock HorizontalAlignment="Left" Foreground="DarkGray" Text="Preview"/>
                                <Border Background="White" BorderBrush="DarkGray" BorderThickness="1" CornerRadius="4" Padding="2">
                                    <rendertoy:ViewSoftwareCustomizable Width="192" Height="128" rendertoy:AttachedView.Scene="{Binding}" rendertoy:AttachedView.TransformModelViewProjection="{Binding Source={StaticResource Camera}, Path=TransformModelViewProjection}"/>
                                </Border>
                            </StackPanel>
                        </Border>
                    </Grid>
                </DockPanel>
            </TabItem>
            <TabItem Header="Materials" DataContext="{Binding Path=Materials}">
                <DockPanel>
                    <!-- ==================== Material List ==================== -->
                    <GroupBox Header="Material Nodes" Margin="4" Padding="4">
                        <ListView x:Name="MaterialList" DockPanel.Dock="Left" ItemsSource="{Binding}" IsSynchronizedWithCurrentItem="True" ItemTemplate="{StaticResource GraphNodeTemplate}">
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                </Style>
                            </ListView.ItemContainerStyle>
                        </ListView>
                    </GroupBox>
                    <!-- ==================== Texture View ==================== -->
                    <ContentControl Content="{Binding ElementName=MaterialList, Path=SelectedItem}">
                        <ContentControl.ContentTemplate>
                            <DataTemplate>
                                <TabControl>
                                    <TabItem Header="Graph">
                                        <DockPanel>
                                            <Menu DockPanel.Dock="Top">
                                                <MenuItem Command="{x:Static rendertoy:ViewZoom.RecenterCommand}" CommandTarget="{Binding ElementName=ViewZoomGraph}"/>>
                                            </Menu>
                                            <rendertoy:ViewZoom x:Name="ViewZoomGraph">
                                                <rendertoy:ViewMaterialGraph Root="{Binding}" NodeTemplate="{StaticResource GraphNode}"/>
                                            </rendertoy:ViewZoom>
                                        </DockPanel>
                                    </TabItem>
                                    <TabItem Header="Preview">
                                        <DockPanel>
                                            <Menu DockPanel.Dock="Top">
                                                <MenuItem Command="{x:Static rendertoy:ViewZoom.RecenterCommand}" CommandTarget="{Binding ElementName=ViewZoomPreview}"/>>
                                            </Menu>
                                            <rendertoy:ViewZoom x:Name="ViewZoomPreview">
                                                <rendertoy:ViewMaterial MaterialSource="{Binding}" MaterialWidth="256" MaterialHeight="256" RenderOptions.BitmapScalingMode="NearestNeighbor"/>
                                            </rendertoy:ViewZoom>
                                        </DockPanel>
                                    </TabItem>
                                </TabControl>
                            </DataTemplate>
                        </ContentControl.ContentTemplate>
                    </ContentControl>
                </DockPanel>
            </TabItem>
            <!-- ==================== Accelerated DirectX Visualizer ==================== -->
            <TabItem Header="DX9" DataContext="{Binding Path=Scene}">
                <Grid Background="Black">
                    <rendertoy:ViewDirectX9FixedFunction rendertoy:AttachedView.Scene="{Binding}" rendertoy:AttachedView.TransformModelViewProjection="{Binding Source={StaticResource Camera}, Path=TransformModelViewProjection}" rendertoy:AttachedCamera.Camera="{StaticResource Camera}"/>
                </Grid>
            </TabItem>
            <!-- ==================== Accelerated DirectX11 Visualizer ==================== -->
            <TabItem Header="DX11" DataContext="{Binding Path=Scene}">
                <Grid Background="Black">
                    <rendertoy:ViewDirectX11 rendertoy:AttachedView.Scene="{Binding}" rendertoy:AttachedView.TransformModelViewProjection="{Binding Source={StaticResource Camera}, Path=TransformModelViewProjection}" rendertoy:AttachedCamera.Camera="{StaticResource Camera}"/>
                </Grid>
            </TabItem>
            <!-- ==================== Accelerated DirectX12 Visualizer ==================== -->
            <TabItem Header="DX12" DataContext="{Binding Path=Scene}">
                <Grid Background="Black">
                    <rendertoy:ViewDirectX12 rendertoy:AttachedView.Scene="{Binding}" rendertoy:AttachedView.TransformModelViewProjection="{Binding Source={StaticResource Camera}, Path=TransformModelViewProjection}" rendertoy:AttachedCamera.Camera="{StaticResource Camera}"/>
                </Grid>
            </TabItem>
            <!-- ==================== Shader Editor ==================== -->
            <TabItem Header="DX9 Shader Editor" DataContext="{Binding Path=Scene}">
                <TabItem.Resources>
                    <rendertoy:CompileVertexShaderConverter x:Key="CompileVertexShaderConverter"/>
                    <rendertoy:CompilePixelShaderConverter x:Key="CompilePixelShaderConverter"/>
                </TabItem.Resources>
                <Grid Background="Black">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="50*"/>
                        <ColumnDefinition Width="50*"/>
                    </Grid.ColumnDefinitions>
                    <AdornerDecorator Grid.Column="0">
                        <TextBox x:Name="ShaderCode" AcceptsReturn="True" FontFamily="Consolas" Background="Black" Foreground="White"/>
                    </AdornerDecorator>
                    <GridSplitter Grid.Column="0" HorizontalAlignment="Right" VerticalAlignment="Stretch" Width="4"/>
                    <rendertoy:ViewDirectX9 Grid.Column="1" rendertoy:AttachedView.Scene="{Binding}" rendertoy:AttachedView.TransformCamera="{Binding Source={StaticResource Camera}, Path=TransformCamera}" rendertoy:AttachedView.TransformView="{Binding Source={StaticResource Camera}, Path=TransformView}" rendertoy:AttachedView.TransformProjection="{Binding Source={StaticResource Camera}, Path=TransformProjection}" rendertoy:AttachedView.TransformModelViewProjection="{Binding Source={StaticResource Camera}, Path=TransformModelViewProjection}" VertexShader="{Binding ElementName=ShaderCode, Path=Text, Converter={StaticResource CompileVertexShaderConverter}}" PixelShader="{Binding ElementName=ShaderCode, Path=Text, Converter={StaticResource CompilePixelShaderConverter}}" rendertoy:AttachedCamera.Camera="{StaticResource Camera}"/>
                </Grid>
            </TabItem>
        </TabControl>
    </DockPanel>
</Window>
