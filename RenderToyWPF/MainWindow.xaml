<Window x:Class="RenderToy.WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:RenderToy.WPF"
        xmlns:materials="clr-namespace:RenderToy.Materials"
        mc:Ignorable="d"
        Title="RenderToy Experiment" Height="600" Width="1024">
    <UserControl>
        <UserControl.Resources>
            <local:Camera x:Key="Camera"/>
            <local:ShortTypeNameConverter x:Key="ShortTypeNameConverter"/>
            <ToolTip x:Key="GraphNodeToolTip">
                <StackPanel>
                    <TextBlock Text="{Binding Converter={StaticResource ShortTypeNameConverter}}" Margin="4"/>
                    <Border Background="Beige" BorderBrush="Black" BorderThickness="1" CornerRadius="4" Margin="4" Padding="4">
                        <local:ViewMaterialThumbnail ThumbnailSource="{Binding}" ThumbnailWidth="256" ThumbnailHeight="256"/>
                    </Border>
                </StackPanel>
            </ToolTip>
            <DataTemplate x:Key="GraphNodeMNAdd">
                <Border Background="Beige" BorderBrush="Black" BorderThickness="2" CornerRadius="4" Padding="2" ToolTip="{StaticResource GraphNodeToolTip}">
                    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="+"/>
                </Border>
            </DataTemplate>
            <DataTemplate x:Key="GraphNodeMNLerp">
                <Border Background="Beige" BorderBrush="Black" BorderThickness="2" CornerRadius="4" Padding="2" ToolTip="{StaticResource GraphNodeToolTip}">
                    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="Lerp"/>
                </Border>
            </DataTemplate>
            <DataTemplate x:Key="GraphNodeMNMultiply">
                <Border Background="Beige" BorderBrush="Black" BorderThickness="2" CornerRadius="4" Padding="2" ToolTip="{StaticResource GraphNodeToolTip}">
                    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="X"/>
                </Border>
            </DataTemplate>
            <DataTemplate x:Key="GraphNodeMNSaturate">
                <Border Background="Beige" BorderBrush="Black" BorderThickness="2" CornerRadius="4" Padding="2" ToolTip="{StaticResource GraphNodeToolTip}">
                    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="Saturate"/>
                </Border>
            </DataTemplate>
            <DataTemplate x:Key="GraphNodeMNSubtract">
                <Border Background="Beige" BorderBrush="Black" BorderThickness="2" CornerRadius="4" Padding="2" ToolTip="{StaticResource GraphNodeToolTip}">
                    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="-"/>
                </Border>
            </DataTemplate>
            <DataTemplate x:Key="GraphNodeMNThreshold">
                <Border Background="Beige" BorderBrush="Black" BorderThickness="2" CornerRadius="4" Padding="2" ToolTip="{StaticResource GraphNodeToolTip}">
                    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="Threshold"/>
                </Border>
            </DataTemplate>
            <DataTemplate x:Key="GraphNodeMNConstant">
                <Border Background="LightGreen" BorderBrush="Black" BorderThickness="2" CornerRadius="4" Padding="2" ToolTip="{StaticResource GraphNodeToolTip}">
                    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="{Binding Path=Value}"/>
                </Border>
            </DataTemplate>
            <DataTemplate x:Key="GraphNodeTexCoordU">
                <Border Background="LightGreen" BorderBrush="Black" BorderThickness="2" CornerRadius="4" Padding="2" ToolTip="{StaticResource GraphNodeToolTip}">
                    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="U"/>
                </Border>
            </DataTemplate>
            <DataTemplate x:Key="GraphNodeTexCoordV">
                <Border Background="LightGreen" BorderBrush="Black" BorderThickness="2" CornerRadius="4" Padding="2" ToolTip="{StaticResource GraphNodeToolTip}">
                    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="V"/>
                </Border>
            </DataTemplate>
            <DataTemplate x:Key="GraphNodeTemplate">
                <Border Background="LightBlue" BorderBrush="Black" BorderThickness="2" CornerRadius="4" Padding="2" ToolTip="{StaticResource GraphNodeToolTip}">
                    <StackPanel Orientation="Horizontal">
                        <local:ViewMaterialThumbnail ThumbnailSource="{Binding}" ThumbnailWidth="32" ThumbnailHeight="32" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding Converter={StaticResource ShortTypeNameConverter}}" Margin="2" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </DataTemplate>
            <local:TypeBasedDataTemplateSelector x:Key="GraphNodeDataTemplateSelector">
                <local:TypeBasedDataTemplate DataType="{x:Type materials:MNAdd}" DataTemplate="{StaticResource GraphNodeMNAdd}"/>
                <local:TypeBasedDataTemplate DataType="{x:Type materials:MNLerp}" DataTemplate="{StaticResource GraphNodeMNLerp}"/>
                <local:TypeBasedDataTemplate DataType="{x:Type materials:MNMultiply}" DataTemplate="{StaticResource GraphNodeMNMultiply}"/>
                <local:TypeBasedDataTemplate DataType="{x:Type materials:MNSaturate}" DataTemplate="{StaticResource GraphNodeMNSaturate}"/>
                <local:TypeBasedDataTemplate DataType="{x:Type materials:MNSubtract}" DataTemplate="{StaticResource GraphNodeMNSubtract}"/>
                <local:TypeBasedDataTemplate DataType="{x:Type materials:MNThreshold}" DataTemplate="{StaticResource GraphNodeMNThreshold}"/>
                <local:TypeBasedDataTemplate DataType="{x:Type materials:MNConstant}" DataTemplate="{StaticResource GraphNodeMNConstant}"/>
                <local:TypeBasedDataTemplate DataType="{x:Type materials:MNTexCoordU}" DataTemplate="{StaticResource GraphNodeTexCoordU}"/>
                <local:TypeBasedDataTemplate DataType="{x:Type materials:MNTexCoordV}" DataTemplate="{StaticResource GraphNodeTexCoordV}"/>
                <local:TypeBasedDataTemplate DataTemplate="{StaticResource GraphNodeTemplate}"/>
            </local:TypeBasedDataTemplateSelector>
        </UserControl.Resources>
        <TabControl>
            <TabItem Header="Interactive View">
                <DockPanel>
                    <!-- Menu -->
                    <Menu DockPanel.Dock="Left">
                        <Menu.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel/>
                            </ItemsPanelTemplate>
                        </Menu.ItemsPanel>
                        <MenuItem Header="File" BorderBrush="Black" BorderThickness="1" Margin="2">
                            <MenuItem Header="New" Command="{x:Static local:MainWindow.CommandSceneNew}"/>
                            <MenuItem Header="Open" Command="{x:Static local:MainWindow.CommandSceneOpen}"/>
                        </MenuItem>
                        <MenuItem Header="View" BorderBrush="Black" BorderThickness="1" Margin="2">
                            <MenuItem Header="Preview" Command="{x:Static local:MainWindow.CommandRenderPreviewsToggle}"/>
                            <MenuItem Header="Wireframe" Command="{x:Static local:MainWindow.CommandRenderWireframeToggle}"/>
                        </MenuItem>
                        <MenuItem Header="Debug" BorderBrush="Black" BorderThickness="1" Margin="2">
                            <MenuItem Header="Performance Trace" Command="{x:Static local:MainWindow.CommandDebugToolPerformanceTrace}"/>
                        </MenuItem>
                    </Menu>
                    <Grid>
                        <!-- Main Viewport Layer -->
                        <local:View3DUser x:Name="ViewMain" Camera="{StaticResource Camera}"/>
                        <!-- Wireframe Layer -->
                        <local:View3DWire x:Name="ViewWireframe" IsHitTestVisible="False" Camera="{StaticResource Camera}" Opacity="0.5"/>
                        <!-- PIP Preview -->
                        <Border x:Name="ViewPreview" HorizontalAlignment="Right" VerticalAlignment="Top" BorderBrush="DarkGray" BorderThickness="2" CornerRadius="8" Margin="8" Padding="4">
                            <Border.Background>
                                <LinearGradientBrush>
                                    <LinearGradientBrush.Transform>
                                        <RotateTransform Angle="45"/>
                                    </LinearGradientBrush.Transform>
                                    <GradientStop Color="LightGray" Offset="0"/>
                                    <GradientStop Color="DarkGray" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <Border.Effect>
                                <DropShadowEffect Opacity="0.5" ShadowDepth="4"/>
                            </Border.Effect>
                            <StackPanel>
                                <TextBlock HorizontalAlignment="Left" Foreground="DarkGray" Text="Preview"/>
                                <Border Background="White" BorderBrush="DarkGray" BorderThickness="1" CornerRadius="4" Padding="2">
                                    <local:View3DUser Width="192" Height="128" Camera="{StaticResource Camera}"/>
                                </Border>
                            </StackPanel>
                        </Border>
                    </Grid>
                </DockPanel>
            </TabItem>
            <TabItem Header="Texture View">
                <DockPanel>
                    <!-- ==================== Material List ==================== -->
                    <GroupBox Header="Material Nodes" Margin="4" Padding="4">
                        <ListView x:Name="MaterialNodes" DockPanel.Dock="Left" ItemsSource="{Binding Path=MaterialNodes}" IsSynchronizedWithCurrentItem="True" ItemTemplate="{StaticResource GraphNodeTemplate}">
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                </Style>
                            </ListView.ItemContainerStyle>
                        </ListView>
                    </GroupBox>
                    <!-- ==================== Texture View ==================== -->
                    <ContentControl Content="{Binding ElementName=MaterialNodes, Path=SelectedItem}">
                        <ContentControl.ContentTemplate>
                            <DataTemplate>
                                <TabControl>
                                    <TabItem Header="Graph">
                                        <local:ViewMaterialGraph Root="{Binding}">
                                            <local:ViewMaterialGraph.NodeTemplate>
                                                <DataTemplate>
                                                    <local:ViewMaterialNode ContentTemplateSelector="{StaticResource GraphNodeDataTemplateSelector}"/>
                                                </DataTemplate>
                                            </local:ViewMaterialGraph.NodeTemplate>
                                        </local:ViewMaterialGraph>
                                    </TabItem>
                                    <TabItem Header="Node">
                                        <local:ViewMaterialNode Content="{Binding}" ContentTemplateSelector="{StaticResource GraphNodeDataTemplateSelector}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </TabItem>
                                    <TabItem Header="Preview">
                                        <local:ViewMaterial Texture="{Binding}"/>
                                    </TabItem>
                                </TabControl>
                            </DataTemplate>
                        </ContentControl.ContentTemplate>
                    </ContentControl>
                </DockPanel>
            </TabItem>
            <TabItem Header="Interactive Document">
                <FlowDocumentReader ViewingMode="Page">
                    <StaticResource ResourceKey="RenderToyDocument"/>
                </FlowDocumentReader>
            </TabItem>
        </TabControl>
    </UserControl>
</Window>
